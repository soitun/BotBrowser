<mat-toolbar>
    <button mat-button (click)="newProxy()">
        <mat-icon>add</mat-icon>
        New Proxy
    </button>

    <button mat-button (click)="bulkImportProxies()">
        <mat-icon>download</mat-icon>
        Bulk Import
    </button>

    <button mat-button (click)="editSelectedProxy()" [disabled]="selection.selected.length != 1">
        <mat-icon>edit</mat-icon>
        Edit
    </button>

    <button mat-button (click)="deleteProxies()" [disabled]="selection.selected.length == 0">
        <mat-icon>delete</mat-icon>
        Delete
    </button>
</mat-toolbar>

@if (loading) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
}

<div class="table-container">
    @if (dataSource.data.length === 0 && !loading) {
        <div class="empty-state">
            <mat-icon>vpn_key</mat-icon>
            <p>No proxies configured</p>
            <p class="hint">Click "New Proxy" to add a proxy server</p>
        </div>
    } @else {
        <table mat-table [dataSource]="dataSource" matSort>
            <ng-container matColumnDef="select">
                <th mat-header-cell *matHeaderCellDef>
                    <mat-checkbox
                        (change)="$event ? toggleAllRows() : null"
                        [checked]="selection.hasValue() && isAllSelected"
                        [indeterminate]="selection.hasValue() && !isAllSelected"
                        [aria-label]="checkboxLabel()"
                    >
                    </mat-checkbox>
                </th>
                <td mat-cell *matCellDef="let row">
                    <mat-checkbox
                        (click)="$event.stopPropagation()"
                        (change)="$event ? selection.toggle(row) : null"
                        [checked]="selection.isSelected(row)"
                        [aria-label]="checkboxLabel(row)"
                    >
                    </mat-checkbox>
                </td>
            </ng-container>

            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
                <td mat-cell *matCellDef="let element">
                    <div class="flex-container">
                        <a class="content proxy-name-link" app-stop-propagation (click)="editProxy(element)">{{
                            element.name
                        }}</a>
                        <button mat-icon-button [matMenuTriggerFor]="menu" app-stop-propagation>
                            <mat-icon>more_vert</mat-icon>
                        </button>
                        <mat-menu #menu="matMenu">
                            <button mat-menu-item (click)="editProxy(element)">
                                <mat-icon>edit</mat-icon>
                                <span>Edit</span>
                            </button>
                            <button mat-menu-item (click)="deleteProxy(element)">
                                <mat-icon>delete</mat-icon>
                                <span>Delete</span>
                            </button>
                        </mat-menu>
                    </div>
                </td>
            </ng-container>

            <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
                <td mat-cell *matCellDef="let element">{{ element.type }}</td>
            </ng-container>

            <ng-container matColumnDef="host">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Address</th>
                <td mat-cell *matCellDef="let element">{{ formatAddress(element) }}</td>
            </ng-container>

            <ng-container matColumnDef="username">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>Username</th>
                <td mat-cell *matCellDef="let element">{{ element.username }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let element; columns: displayedColumns" (click)="toggleSelectProxy(element)"></tr>
        </table>
    }
</div>
